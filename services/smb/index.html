<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="SMB (Server Message Block) #  At a Glance #   Default Ports
 SMB over NBT (NetBIOS over TCP/IP): 139 SMB over TCP/IP: 445   SMB is a network communication protocol for providing shared access to files, printers, and serial ports between nodes on a network. It also provides an authenticated IPC (inter-process communication) mechanism.1
Windows SMB Ports and Protocols #  Originally, in Windows NT, SMB ran on top of NBT (NetBIOS over TCP/IP), which uses ports UDP 137 and 138, and TCP 139."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="SMB (Server Message Block) Service Enumeration"><meta property="og:description" content="SMB (Server Message Block) #  At a Glance #   Default Ports
 SMB over NBT (NetBIOS over TCP/IP): 139 SMB over TCP/IP: 445   SMB is a network communication protocol for providing shared access to files, printers, and serial ports between nodes on a network. It also provides an authenticated IPC (inter-process communication) mechanism.1
Windows SMB Ports and Protocols #  Originally, in Windows NT, SMB ran on top of NBT (NetBIOS over TCP/IP), which uses ports UDP 137 and 138, and TCP 139."><meta property="og:type" content="article"><meta property="og:url" content="https://0xffsec.com/handbook/services/smb/"><meta property="og:image" content="https://0xffsec.com/handbook/images/banner.png"><meta property="article:section" content="services"><meta property="article:modified_time" content="2022-07-03T13:34:08+02:00"><meta itemprop=name content="SMB (Server Message Block) Service Enumeration"><meta itemprop=description content="SMB (Server Message Block) #  At a Glance #   Default Ports
 SMB over NBT (NetBIOS over TCP/IP): 139 SMB over TCP/IP: 445   SMB is a network communication protocol for providing shared access to files, printers, and serial ports between nodes on a network. It also provides an authenticated IPC (inter-process communication) mechanism.1
Windows SMB Ports and Protocols #  Originally, in Windows NT, SMB ran on top of NBT (NetBIOS over TCP/IP), which uses ports UDP 137 and 138, and TCP 139."><meta itemprop=dateModified content="2022-07-03T13:34:08+02:00"><meta itemprop=wordCount content="841"><meta itemprop=image content="https://0xffsec.com/handbook/images/banner.png"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://0xffsec.com/handbook/images/banner.png"><meta name=twitter:title content="SMB (Server Message Block) Service Enumeration"><meta name=twitter:description content="SMB (Server Message Block) #  At a Glance #   Default Ports
 SMB over NBT (NetBIOS over TCP/IP): 139 SMB over TCP/IP: 445   SMB is a network communication protocol for providing shared access to files, printers, and serial ports between nodes on a network. It also provides an authenticated IPC (inter-process communication) mechanism.1
Windows SMB Ports and Protocols #  Originally, in Windows NT, SMB ran on top of NBT (NetBIOS over TCP/IP), which uses ports UDP 137 and 138, and TCP 139."><title>SMB (Server Message Block) Service Enumeration | 0xffsec Handbook</title><link rel=manifest href=https://0xffsec.com/handbook/manifest.json><link rel=icon href=https://0xffsec.com/handbook/favicon.png type=image/x-icon><link rel=stylesheet href=https://0xffsec.com/handbook/book.min.d49b15b58fa9e1961e9b869764b7bf320cb91db58ac5a303597bdb2dab198adc.css integrity="sha256-1JsVtY+p4ZYem4aXZLe/Mgy5HbWKxaMDWXvbLasZitw=" crossorigin=anonymous><script defer src=https://0xffsec.com/handbook/flexsearch.min.js></script><script defer src=https://0xffsec.com/handbook/en.search.min.6ac1ddb14a810cd31e9e434441869e8691d77b4351aa838cc3d79f4db7a56f81.js integrity="sha256-asHdsUqBDNMenkNEQYaehpHXe0NRqoOMw9efTbelb4E=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-8XT169B9C6"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-8XT169B9C6',{anonymize_ip:!1})}</script><link rel=apple-touch-icon sizes=180x180 href=https://0xffsec.com/handbook/images/apple-touch-icon.png><link rel=icon type=image/png sizes=96x96 href=https://0xffsec.com/handbook/images/favicon-96x96.png><link rel=icon type=image/png sizes=32x32 href=https://0xffsec.com/handbook/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://0xffsec.com/handbook/images/favicon-16x16.png></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=https://0xffsec.com/handbook/><img src=https://0xffsec.com/handbook/images/logo.png alt=Logo><span>0xffsec Handbook</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-35d81374824c25dc2919edbbc61d971f class=toggle>
<label for=section-35d81374824c25dc2919edbbc61d971f class="flex justify-between"><a role=button>Information Gathering</a></label><ul><li><a href=https://0xffsec.com/handbook/information-gathering/assets-discovery/>Assets Discovery</a></li><li><a href=https://0xffsec.com/handbook/information-gathering/subdomain-enumeration/>Subdomain Enumeration</a></li></ul></li><li><input type=checkbox id=section-235f64cfc2023c9b7289c228d0c51f53 class=toggle>
<label for=section-235f64cfc2023c9b7289c228d0c51f53 class="flex justify-between"><a role=button>Discovery and Scanning</a></label><ul><li><a href=https://0xffsec.com/handbook/discovery-and-scanning/host-discovery/>Host Discovery</a></li><li><a href=https://0xffsec.com/handbook/discovery-and-scanning/port-scanning/>Port Scanning</a></li></ul></li><li><a href=https://0xffsec.com/handbook/exploits-search/>Exploit Search</a></li><li><a href=https://0xffsec.com/handbook/brute-forcing/>Brute Forcing</a></li><li><input type=checkbox id=section-057108a1c1a3662b9db6ab679412fa8f class=toggle checked>
<label for=section-057108a1c1a3662b9db6ab679412fa8f class="flex justify-between"><a href=https://0xffsec.com/handbook/services/>Service Enumeration</a></label><ul><li><a href=https://0xffsec.com/handbook/services/ftp/>FTP - 21</a></li><li><a href=https://0xffsec.com/handbook/services/smtp/>SMTP - 25 / 465 / 587</a></li><li><a href=https://0xffsec.com/handbook/services/dns/>DNS - 53</a></li><li><a href=https://0xffsec.com/handbook/services/finger/>Finger - 79</a></li><li><a href=https://0xffsec.com/handbook/services/http-https/>HTTP/S - 80 / 443</a></li><li><a href=https://0xffsec.com/handbook/services/pop/>POP - 110 / 995</a></li><li><a href=https://0xffsec.com/handbook/services/nntp/>NNTP - 119 / 433 / 563</a></li><li><a href=https://0xffsec.com/handbook/services/msrpc/>MSRPC - 135 / 593</a></li><li><a href=https://0xffsec.com/handbook/services/netbios/>NetBIOS - 137 / 138 / 139</a></li><li><a href=https://0xffsec.com/handbook/services/smb/ class=active>SMB - 139 / 445</a></li><li><a href=https://0xffsec.com/handbook/services/imap/>IMAP - 143 / 993</a></li></ul></li><li><a href=https://0xffsec.com/handbook/steganography/>Steganography</a></li><li><input type=checkbox id=section-4710461fd82136af748c8186e2a511e1 class=toggle>
<label for=section-4710461fd82136af748c8186e2a511e1 class="flex justify-between"><a role=button>Web Applications</a></label><ul><li><a href=https://0xffsec.com/handbook/web-applications/cgi/>CGI</a></li><li><a href=https://0xffsec.com/handbook/web-applications/command-injection/>Command Injection</a></li><li><a href=https://0xffsec.com/handbook/web-applications/csrf/>CSRF</a></li><li><a href=https://0xffsec.com/handbook/web-applications/file-inclusion-and-path-traversal/>LFI / RFI and Path Traversal</a></li></ul></li><li><input type=checkbox id=section-9b274a52224e37b079acf4aae5f9f128 class=toggle>
<label for=section-9b274a52224e37b079acf4aae5f9f128 class="flex justify-between"><a role=button>Shells</a></label><ul><li><a href=https://0xffsec.com/handbook/shells/reverse-shells/>Reverse Shells</a></li><li><a href=https://0xffsec.com/handbook/shells/full-tty/>Upgrade to Full TTY</a></li><li><a href=https://0xffsec.com/handbook/shells/restricted-shells/>Escape Restricted Shells</a></li></ul></li><li><a href=https://0xffsec.com/handbook/exfiltration/>Data Exfiltration</a></li><li><input type=checkbox id=section-ef46fe0aac274900fefdd5e564e236b2 class=toggle>
<label for=section-ef46fe0aac274900fefdd5e564e236b2 class="flex justify-between"><a href=https://0xffsec.com/handbook/notes/>Notes</a></label><ul><li><a href=https://0xffsec.com/handbook/notes/how-to-open-jar-files/>JAR Files</a></li><li><a href=https://0xffsec.com/handbook/notes/smb-protocol-negotiation-failed/>SMB Protocol Negotiation Failed</a></li><li><a href=https://0xffsec.com/handbook/notes/ssh-legacy-key-exchange/>SSH Legacy Key Exchange</a></li></ul></li><li><a href=https://0xffsec.com/handbook/further-reading/>Further Reading</a></li></ul><ul><li><a href=https://github.com/0xffsec/handbook target=_blank rel=noopener>GitHub</a></li></ul></nav><script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://0xffsec.com/handbook/svg/menu.svg class=book-icon alt=Menu></label>
<strong>SMB (Server Message Block) Service Enumeration</strong>
<label for=toc-control><img src=https://0xffsec.com/handbook/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#at-a-glance>At a Glance</a><ul><li></li></ul></li><li><a href=#smb-host-discovery>SMB Host Discovery</a></li><li><a href=#server-version>Server Version</a><ul><li></li></ul></li><li><a href=#common-login-credentials>Common Login Credentials</a></li><li><a href=#enumeration>Enumeration</a><ul><li></li></ul></li><li><a href=#rpc-enumeration>RPC Enumeration</a></li><li><a href=#null-session>Null Session</a><ul><li><a href=#windows-administrative-shares>Windows Administrative Shares</a></li><li><a href=#ipc-share>IPC$ Share</a></li></ul></li><li><a href=#mount-shares-mount-smb>Mount Shares</a></li><li><a href=#download-files>Download Files</a></li><li><a href=#brute-forcing>Brute Forcing</a></li><li><a href=#smb-exploits-search>SMB Exploits Search</a></li></ul></nav></aside></header><article class=markdown><h1 id=smb-server-message-block>SMB (Server Message Block)
<a class=anchor href=#smb-server-message-block>#</a></h1><h2 id=at-a-glance>At a Glance
<a class=anchor href=#at-a-glance>#</a></h2><div class=book-highlight><p><p><strong>Default Ports</strong></p><ul><li>SMB over NBT (<a href=https://0xffsec.com/handbook/services/netbios/>NetBIOS</a> over TCP/IP): 139</li><li>SMB over TCP/IP: 445</li></ul></p></div><p>SMB is a network communication protocol for providing shared access to files, printers, and serial ports between nodes on a network. It also provides an authenticated IPC (inter-process communication) mechanism.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><h4 id=windows-smb-ports-and-protocols>Windows SMB Ports and Protocols
<a class=anchor href=#windows-smb-ports-and-protocols>#</a></h4><p>Originally,
in Windows NT,
SMB ran on top of NBT (NetBIOS over TCP/IP),
which uses ports UDP 137 and 138,
and TCP 139.
With Windows 2000,
was introduced what Microsoft calls &ldquo;direct hosting&rdquo;,
the option to run &ldquo;NetBIOS-less&rdquo; SMB,
directly over TCP/445.</p><p>Older versions of Windows
(with NBT enabled)
will try to connect to both port 139
and 445 simultaneously,
while in newer versions,
port 139 is a fall-back port,
as clients will try to connect to port 445
by default.<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><h2 id=smb-host-discovery>SMB Host Discovery
<a class=anchor href=#smb-host-discovery>#</a></h2><p>Refer to <a href=https://0xffsec.com/handbook/discovery-and-scanning/host-discovery/#nbtscan---netbios-nbtscan>host discovert with nbtscan</a>.</p><h2 id=server-version>Server Version
<a class=anchor href=#server-version>#</a></h2><h4 id=metasploit-smb-auxiliary-module-metasploit-smb-auxiliary-module>Metasploit SMB Auxiliary Module <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>
<a class=anchor href=#metasploit-smb-auxiliary-module-metasploit-smb-auxiliary-module>#</a></h4><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>msf&gt; use auxiliary/scanner/smb/smb_version
msf&gt; <span style=color:#24909d>set</span> rhost 10.0.0.3
msf&gt; run
</code></pre></div><h2 id=common-login-credentials>Common Login Credentials
<a class=anchor href=#common-login-credentials>#</a></h2><p>Backup and Management software requires dedicated user accounts on the server or local machine to function, and are often set with a weak password. <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></p><table><thead><tr><th>Usernmae</th><th>Password</th></tr></thead><tbody><tr><td>(blank)</td><td>(blank)</td></tr><tr><td><code>Administrator</code> <code>admin</code> <code>guest</code></td><td>(blank) <code>admin</code> <code>password</code></td></tr><tr><td><code>arcserve</code></td><td><code>arcserve</code> <code>backup</code></td></tr><tr><td><code>tivoli</code></td><td><code>tivoli</code></td></tr><tr><td><code>backupexec</code></td><td><code>backupexec</code> <code>backup</code></td></tr><tr><td><code>test</code></td><td><code>test</code></td></tr></tbody></table><h2 id=enumeration>Enumeration
<a class=anchor href=#enumeration>#</a></h2><div class=book-note><div class=book-note-icon><svg width="23" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 60a15 15 0 000 30c50 0 90 40 90 90a15 15 0 0030 0c0-66-54-120-120-120z"/><path d="M217 4a179 179 0 00-96 295c19 22 30 49 30 77v30c0 20 13 37 31 43 6 35 36 63 74 63s68-28 74-63c18-6 31-23 31-43v-30c0-28 11-55 30-78A180 180 0 00217 4zm39 478c-19 0-36-13-42-31h84c-6 18-23 31-42 31zm75-76c0 8-7 15-15 15H196c-8 0-15-7-15-15v-15h150v15zm38-127c-21 24-34 52-37 82H180c-3-30-16-59-36-82a150 150 0 11225 0zM45 180H15a15 15 0 000 30h30a15 15 0 000-30z"/><path d="M51 105 30 84A15 15 0 109 105l21 21a15 15 0 1021-21zm0 159c-6-6-15-6-21 0L9 285a15 15 0 1021 21l21-21c6-6 6-15 0-21zm446-84h-30a15 15 0 000 30h30a15 15 0 000-30zm6-96c-6-6-15-6-21 0l-21 21a15 15 0 1021 21l21-21c6-6 6-15 0-21zm0 201-21-21a15 15 0 10-21 21l21 21a15 15 0 0021-21z"/></svg></div><div class=book-note-text><p><b>Note:</b>
If <code>Protocol negotiation failed: NT_STATUS_IO_TIMEOUT</code> is returned,
refer to <a href=https://0xffsec.com/handbook/notes/smb-protocol-negotiation-failed/>SMB Protocol Negotiation Failed</a></p></div></div><h4 id=enum4linux-enum4linux>enum4linux <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>
<a class=anchor href=#enum4linux-enum4linux>#</a></h4><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>enum4linux -a 10.0.0.3
</code></pre></div><p>With credentials:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>enum4linux -a -u <span style=color:#ed9d13>&#34;&lt;username&gt;&#34;</span> -p <span style=color:#ed9d13>&#34;&lt;passwd&gt;&#34;</span> 10.0.0.3
</code></pre></div><details><summary>Parameters</summary><div class=markdown-inner><ul><li><code>-a</code>: Do all simple enumeration (-U -S -G -P -r -o -n -i).</li><li><code>-u &lt;user></code>: specify username to use.</li><li><code>-p &lt;pass></code>: specify password to use.</li></ul></div></details><h4 id=nse-scripts>NSE Scripts
<a class=anchor href=#nse-scripts>#</a></h4><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>nmap --script <span style=color:#ed9d13>&#34;safe or smb-enum-*&#34;</span> -p 139,445 10.0.0.3
</code></pre></div><div class=book-note><div class=book-note-icon><svg width="23" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 60a15 15 0 000 30c50 0 90 40 90 90a15 15 0 0030 0c0-66-54-120-120-120z"/><path d="M217 4a179 179 0 00-96 295c19 22 30 49 30 77v30c0 20 13 37 31 43 6 35 36 63 74 63s68-28 74-63c18-6 31-23 31-43v-30c0-28 11-55 30-78A180 180 0 00217 4zm39 478c-19 0-36-13-42-31h84c-6 18-23 31-42 31zm75-76c0 8-7 15-15 15H196c-8 0-15-7-15-15v-15h150v15zm38-127c-21 24-34 52-37 82H180c-3-30-16-59-36-82a150 150 0 11225 0zM45 180H15a15 15 0 000 30h30a15 15 0 000-30z"/><path d="M51 105 30 84A15 15 0 109 105l21 21a15 15 0 1021-21zm0 159c-6-6-15-6-21 0L9 285a15 15 0 1021 21l21-21c6-6 6-15 0-21zm446-84h-30a15 15 0 000 30h30a15 15 0 000-30zm6-96c-6-6-15-6-21 0l-21 21a15 15 0 1021 21l21-21c6-6 6-15 0-21zm0 201-21-21a15 15 0 10-21 21l21 21a15 15 0 0021-21z"/></svg></div><div class=book-note-text><p><b>Note:</b><p>NSE SMB enumeration scripts:</p><ul><li><code>smb-enum-domains</code></li><li><code>smb-enum-groups</code></li><li><code>smb-enum-processes</code></li><li><code>smb-enum-services</code></li><li><code>smb-enum-sessions</code></li><li><code>smb-enum-shares</code></li><li><code>smb-enum-users</code></li></ul></p></div></div><h4 id=smbclient-smbclient>smbclient <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>
<a class=anchor href=#smbclient-smbclient>#</a></h4><p>List available shares.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>smbclient -N -L //10.0.0.3
</code></pre></div><p>Connect to a share.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>smbclient -N //10.0.0.3/Share
</code></pre></div><details><summary>Parameters</summary><div class=markdown-inner><ul><li><code>-N</code>: remove the password prompt from the client to the user.</li><li><code>-L</code>: list services available on the server.</li></ul></div></details><h2 id=rpc-enumeration>RPC Enumeration
<a class=anchor href=#rpc-enumeration>#</a></h2><div class=book-note><div class=book-note-icon><svg width="23" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 60a15 15 0 000 30c50 0 90 40 90 90a15 15 0 0030 0c0-66-54-120-120-120z"/><path d="M217 4a179 179 0 00-96 295c19 22 30 49 30 77v30c0 20 13 37 31 43 6 35 36 63 74 63s68-28 74-63c18-6 31-23 31-43v-30c0-28 11-55 30-78A180 180 0 00217 4zm39 478c-19 0-36-13-42-31h84c-6 18-23 31-42 31zm75-76c0 8-7 15-15 15H196c-8 0-15-7-15-15v-15h150v15zm38-127c-21 24-34 52-37 82H180c-3-30-16-59-36-82a150 150 0 11225 0zM45 180H15a15 15 0 000 30h30a15 15 0 000-30z"/><path d="M51 105 30 84A15 15 0 109 105l21 21a15 15 0 1021-21zm0 159c-6-6-15-6-21 0L9 285a15 15 0 1021 21l21-21c6-6 6-15 0-21zm446-84h-30a15 15 0 000 30h30a15 15 0 000-30zm6-96c-6-6-15-6-21 0l-21 21a15 15 0 1021 21l21-21c6-6 6-15 0-21zm0 201-21-21a15 15 0 10-21 21l21 21a15 15 0 0021-21z"/></svg></div><div class=book-note-text><p><b>Note:</b>
<code>rpcclient</code>, <code>impacket</code>, and more, under <a href=https://0xffsec.com/handbook/services/msrpc/#enumeration>RPC Enumeration</a>.</p></div></div><h2 id=null-session>Null Session
<a class=anchor href=#null-session>#</a></h2><h3 id=windows-administrative-shares>Windows Administrative Shares
<a class=anchor href=#windows-administrative-shares>#</a></h3><p>Administrative shares are hidden shares that provide administrators the ability to remotely manage hosts. <strong>They are automatically created and enabled by default</strong>.</p><div class=book-note><div class=book-note-icon><svg width="23" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 60a15 15 0 000 30c50 0 90 40 90 90a15 15 0 0030 0c0-66-54-120-120-120z"/><path d="M217 4a179 179 0 00-96 295c19 22 30 49 30 77v30c0 20 13 37 31 43 6 35 36 63 74 63s68-28 74-63c18-6 31-23 31-43v-30c0-28 11-55 30-78A180 180 0 00217 4zm39 478c-19 0-36-13-42-31h84c-6 18-23 31-42 31zm75-76c0 8-7 15-15 15H196c-8 0-15-7-15-15v-15h150v15zm38-127c-21 24-34 52-37 82H180c-3-30-16-59-36-82a150 150 0 11225 0zM45 180H15a15 15 0 000 30h30a15 15 0 000-30z"/><path d="M51 105 30 84A15 15 0 109 105l21 21a15 15 0 1021-21zm0 159c-6-6-15-6-21 0L9 285a15 15 0 1021 21l21-21c6-6 6-15 0-21zm446-84h-30a15 15 0 000 30h30a15 15 0 000-30zm6-96c-6-6-15-6-21 0l-21 21a15 15 0 1021 21l21-21c6-6 6-15 0-21zm0 201-21-21a15 15 0 10-21 21l21 21a15 15 0 0021-21z"/></svg></div><div class=book-note-text><p><b>Note:</b>
It is worth clarifying these shares are not hidden but removed from views just by appending a dollar sign (<code>$</code>) to the share name. Ultimately, the share will be part of the result if listing from a Unix-based system or by using: <code>net share</code> and <code>net view /all</code>.</p></div></div><p>Various shares are exposed to clients via SMB, as follows:</p><ul><li><code>C$</code>: C Drive on the remote machine.</li><li><code>Admin$</code>: Windows installation directory.</li><li><code>IPC$</code>: The inter-process communication or IPC share.</li><li><code>SYSVOL</code> and <code>NETLOGON</code>: domain controller shares.</li><li><code>PRINT$</code> and <code>FAX$</code>: printer and fax shares.</li></ul><h3 id=ipc-share>IPC$ Share
<a class=anchor href=#ipc-share>#</a></h3><p><code>IPC$</code> is a special share
used to facilitate inter-process communication (<code>IPC</code>).
It does not allow access to files or directories,
but it allows to communicate
with processes running on the remote system.</p><p>Specifically, <strong><code>IPC$</code>, exposes named pipes</strong>,
which can be written or read
to communicate with remote processes.
These named pipes
are opened by the application
and registered with SMB
so that it can be exposed by the <code>IPC$</code> share.</p><p>They are usually used
to perform specific functions on the remote system,
also known as <strong>RPC</strong> or remote procedure calls.</p><p>Some versions of Windows
allow you to authenticate
and mount the <code>IPC$</code> share
without providing a username and password.
Such a connection is often called a NULL session,
which,
despite its limited privileges,
could be used to make multiple RPC calls
and obtain useful information
about the remote system.<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup></p><div class=book-note><div class=book-note-icon><svg width="23" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 60a15 15 0 000 30c50 0 90 40 90 90a15 15 0 0030 0c0-66-54-120-120-120z"/><path d="M217 4a179 179 0 00-96 295c19 22 30 49 30 77v30c0 20 13 37 31 43 6 35 36 63 74 63s68-28 74-63c18-6 31-23 31-43v-30c0-28 11-55 30-78A180 180 0 00217 4zm39 478c-19 0-36-13-42-31h84c-6 18-23 31-42 31zm75-76c0 8-7 15-15 15H196c-8 0-15-7-15-15v-15h150v15zm38-127c-21 24-34 52-37 82H180c-3-30-16-59-36-82a150 150 0 11225 0zM45 180H15a15 15 0 000 30h30a15 15 0 000-30z"/><path d="M51 105 30 84A15 15 0 109 105l21 21a15 15 0 1021-21zm0 159c-6-6-15-6-21 0L9 285a15 15 0 1021 21l21-21c6-6 6-15 0-21zm446-84h-30a15 15 0 000 30h30a15 15 0 000-30zm6-96c-6-6-15-6-21 0l-21 21a15 15 0 1021 21l21-21c6-6 6-15 0-21zm0 201-21-21a15 15 0 10-21 21l21 21a15 15 0 0021-21z"/></svg></div><div class=book-note-text><p><b>Note:</b>
RPC endpoints exposed via IPC$
include the Server service,
Task Scheduler,
Local Security Authority (LSA),
and Service Control Manager (SCM).
Upon authenticating,
you can use these
to enumerate user and system details,
access the registry,
and execute commands</p></div></div><p>In Linux
<a href=#enum4linux-enum4linux>enum4linux</a> utility
can be used to dump data
from these service</p><p>Refer to <a href=https://0xffsec.com/handbook/services/msrpc/>MSRPC</a> for more about RPC.</p><h2 id=mount-shares-mount-smb>Mount Shares <sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>
<a class=anchor href=#mount-shares-mount-smb>#</a></h2><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>mount -t cifs -o <span style=color:#40ffff>username</span>=user,password=password //10.0.0.3/Share /mnt/share
</code></pre></div><h2 id=download-files>Download Files
<a class=anchor href=#download-files>#</a></h2><p>Create a tar file of the files beneath <code>users/docs</code>. <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup></p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>smbclient //10.0.0.3/Share <span style=color:#ed9d13>&#34;&#34;</span> -N -Tc backup.tar users/docs
</code></pre></div><details><summary>Parameters</summary><div class=markdown-inner><ul><li><code>-N</code>: remove the password prompt from the client to the user.</li><li><code>-T</code>: TAR options.</li><li><code>c</code>: Create a tar backup archive on the local system.</li></ul></div></details><h2 id=brute-forcing>Brute Forcing
<a class=anchor href=#brute-forcing>#</a></h2><p>Refer to <a href=https://0xffsec.com/handbook/brute-forcing/#smb>SMB Brute Forcing</a></p><h2 id=smb-exploits-search>SMB Exploits Search
<a class=anchor href=#smb-exploits-search>#</a></h2><p>Refer to <a href=https://0xffsec.com/handbook/exploits-search/>Exploits Search</a></p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Contributors to Wikimedia projects. “Server Message Block - Wikipedia.” Wikipedia, the Free Encyclopedia, Wikimedia Foundation, Inc., 26 Oct. 2003, <a href=https://en.wikipedia.org/wiki/Server_Message_Block>https://en.wikipedia.org/wiki/Server_Message_Block</a>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>“The Use of TCP Ports 139 and 445 in Windows.” Vidstrom Labs, <a href=https://vidstromlabs.com/blog/the-use-of-tcp-ports-139-and-445-in-windows/>https://vidstromlabs.com/blog/the-use-of-tcp-ports-139-and-445-in-windows/</a>.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>“Scanner SMB Auxiliary Modules - Metasploit Unleashed.” Infosec Training and Penetration Testing | Offensive Security, <a href=https://www.offensive-security.com/metasploit-unleashed/scanner-smb-auxiliary-modules/>https://www.offensive-security.com/metasploit-unleashed/scanner-smb-auxiliary-modules/</a>.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>McNab, Chris. Network Security Assessment. “O’Reilly Media, Inc.,” 2007, p. 281.&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5 role=doc-endnote><p>“Enum4linux.” Enum4linux | Portcullis Labs, Portcullis Computer Security Ltd & Portcullis Inc., 16 Sept. 2008, <a href=https://labs.portcullis.co.uk/tools/enum4linux/>https://labs.portcullis.co.uk/tools/enum4linux/</a>.&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6 role=doc-endnote><p>“Smbclient.” Samba - Opening Windows to a Wider World, <a href=https://www.samba.org/samba/docs/current/man-html/smbclient.1.html>https://www.samba.org/samba/docs/current/man-html/smbclient.1.html</a>.&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7 role=doc-endnote><p>“A New Look at Null Sessions and User Enumeration.” SensePost, <a href=https://sensepost.com/blog/2018/a-new-look-at-null-sessions-and-user-enumeration/>https://sensepost.com/blog/2018/a-new-look-at-null-sessions-and-user-enumeration/</a>.&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8 role=doc-endnote><p>“Mounting Samba Shares from a Unix Client.” SambaWiki, <a href=https://wiki.samba.org/index.php/Mounting_samba_shares_from_a_unix_client>https://wiki.samba.org/index.php/Mounting_samba_shares_from_a_unix_client</a>.&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/0xffsec/handbook/commit/0e8857f03498950efc6c0a6e1d7669d7ea39f1f8 title="Last modified by Max Rodrigo | July 3, 2022" target=_blank rel=noopener><img src=https://0xffsec.com/handbook/svg/calendar.svg class=book-icon alt=Calendar>
<span>July 3, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/0xffsec/handbook/edit/master/content/content/services/smb.md target=_blank rel=noopener><img src=https://0xffsec.com/handbook/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#at-a-glance>At a Glance</a><ul><li></li></ul></li><li><a href=#smb-host-discovery>SMB Host Discovery</a></li><li><a href=#server-version>Server Version</a><ul><li></li></ul></li><li><a href=#common-login-credentials>Common Login Credentials</a></li><li><a href=#enumeration>Enumeration</a><ul><li></li></ul></li><li><a href=#rpc-enumeration>RPC Enumeration</a></li><li><a href=#null-session>Null Session</a><ul><li><a href=#windows-administrative-shares>Windows Administrative Shares</a></li><li><a href=#ipc-share>IPC$ Share</a></li></ul></li><li><a href=#mount-shares-mount-smb>Mount Shares</a></li><li><a href=#download-files>Download Files</a></li><li><a href=#brute-forcing>Brute Forcing</a></li><li><a href=#smb-exploits-search>SMB Exploits Search</a></li></ul></nav></div></aside></main></body></html>